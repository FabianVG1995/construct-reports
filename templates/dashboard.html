{% extends "base.html" %}
{% block content %}
<div class="d-flex align-items-center mb-3">
  <h4 class="me-auto">Panel de reportes</h4>
  <a class="btn btn-outline-secondary me-2" href="{{ url_for('admin', key=key) }}">Limpiar filtros</a>
  <a class="btn btn-success" href="{{ url_for('export_csv', key=key) }}">CSV</a>
  <a class="btn btn-warning me-2" href="{{ url_for('export_xlsx', key=key) }}">Excel</a>
  <a class="btn btn-danger" href="{{ url_for('export_pdf', key=key) }}">PDF</a>
</div>
<form method="get" class="card card-body shadow-sm mb-3" action="{{ url_for('admin') }}">
  <input type="hidden" name="key" value="{{ key }}">
  <div class="row g-2">
    <div class="col-md-4">
      <label class="form-label">Buscar (lugar/actividad)</label>
      <input class="form-control" name="q" value="{{ q }}">
    </div>
    <div class="col-md-4">
      <label class="form-label">Filtrar por área</label>
      <input class="form-control" name="area" value="{{ area }}">
    </div>
    <div class="col-md-4">
      <label class="form-label">Filtrar por especialidad</label>
      <input class="form-control" name="esp" value="{{ esp }}">
    </div>
  </div>
  <div class="mt-3 text-end">
    <button class="btn btn-primary">Aplicar</button>
  </div>
</form>

<div class="row g-3">
  {% for r in reports %}
  <div class="col-md-6 col-xl-4">
    <div class="card h-100 shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-start">
          <h5 class="card-title">{{ r.area_trabajo }}</h5>
          <span class="badge text-bg-primary">{{ r.created_at.strftime('%Y-%m-%d') }}</span>
        </div>
        <div class="text-muted small">{{ r.lugar_trabajo }} • {{ r.especialidad }}</div>
        <p class="mt-2">{{ r.actividad[:120] }}{% if r.actividad|length > 120 %}...{% endif %}</p>
        <div class="d-flex gap-2 flex-wrap">
          {% if r.foto_antes %}<a class="btn btn-sm btn-outline-secondary" target="_blank" href="{{ r.foto_antes }}">Ver ANTES</a>{% endif %}
          {% if r.foto_despues %}<a class="btn btn-sm btn-outline-secondary" target="_blank" href="{{ r.foto_despues }}">Ver DESPUÉS</a>{% endif %}
          <a class="btn btn-sm btn-primary ms-auto" href="{{ url_for('report_detail', rid=r.id, key=key) }}">Abrir</a>
        </div>
      </div>
    </div>
  </div>
  {% else %}
    <div class="col-12"><div class="alert alert-info">No hay reportes con esos filtros aún.</div></div>
  {% endfor %}
</div>
{% endblock %}